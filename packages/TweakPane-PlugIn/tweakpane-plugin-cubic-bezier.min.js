!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TweakpaneCubicBezierPlugin={})}(this,(function(e){"use strict";function t(e){return null==e}class s{constructor(){this.observers_={}}on(e,t){let s=this.observers_[e];return s||(s=this.observers_[e]=[]),s.push({handler:t}),this}off(e,t){const s=this.observers_[e];return s&&(this.observers_[e]=s.filter((e=>e.handler!==t))),this}emit(e,t){const s=this.observers_[e];s&&s.forEach((e=>{e.handler(t)}))}}class i{constructor(e,t){var i;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(i=null==t?void 0:t.equals)&&void 0!==i?i:(e,t)=>e===t,this.emitter=new s,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){const t=this.constraint_?this.constraint_.constrain(e):e;!this.equals_(this.rawValue_,t)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=t,this.emitter.emit("change",{rawValue:t,sender:this}))}}class n{constructor(e){this.emitter=new s,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.value_!==e&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{sender:this,rawValue:this.value_}))}}function o(e,t){const s=null==t?void 0:t.constraint,o=null==t?void 0:t.equals;return s||o?new i(e,t):new n(e)}class r{constructor(e){this.emitter=new s,this.valMap_=e;for(const e in this.valMap_){this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}}static createCore(e){return Object.keys(e).reduce(((t,s)=>Object.assign(t,{[s]:o(e[s])})),{})}static fromObject(e){const t=this.createCore(e);return new r(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function a(e){return t=>s=>{if(!t&&void 0===s)return{succeeded:!1,value:void 0};if(t&&void 0===s)return{succeeded:!0,value:void 0};const i=e(s);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function l(e){return{custom:t=>a(t)(e),boolean:a((e=>"boolean"==typeof e?e:void 0))(e),number:a((e=>"number"==typeof e?e:void 0))(e),string:a((e=>"string"==typeof e?e:void 0))(e),function:a((e=>"function"==typeof e?e:void 0))(e),constant:t=>a((e=>e===t?t:void 0))(e),raw:a((e=>e))(e),object:t=>a((e=>{var s;if(null!==(s=e)&&"object"==typeof s)return function(e,t){return Object.keys(t).reduce(((s,i)=>{if(void 0===s)return;const n=(0,t[i])(e[i]);return n.succeeded?Object.assign(Object.assign({},s),{[i]:n.value}):void 0}),{})}(e,t)}))(e),array:t=>a((e=>{var s;if(Array.isArray(e))return s=t,e.reduce(((e,t)=>{if(void 0===e)return;const i=s(t);return i.succeeded&&void 0!==i.value?[...e,i.value]:void 0}),[])}))(e)}}const h={optional:l(!0),required:l(!1)};const c="tp";function u(e){return(t,s)=>[c,"-",e,"v",t?`_${t}`:"",s?`-${s}`:""].join("")}const p=u(""),d={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};const v="http://www.w3.org/2000/svg";function m(e){e.offsetHeight}function g(e){return e.rawValue}function b(e,t){var s,i;e.emitter.on("change",(s=g,i=t,e=>i(s(e)))),t(e.rawValue)}function _(e,t,s){b(e.value(t),s)}const w=u("lbl");class f{constructor(e,s){this.element=e.createElement("div"),this.element.classList.add(w()),s.viewProps.bindClassModifiers(this.element);const i=e.createElement("div");i.classList.add(w("l")),_(s.props,"label",(s=>{t(s)?this.element.classList.add(w(void 0,"nol")):(this.element.classList.remove(w(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(i),i.appendChild(function(e,t){const s=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,i)=>{i>0&&s.appendChild(e.createElement("br")),s.appendChild(t)})),s}(e,s)))})),this.element.appendChild(i),this.labelElement=i;const n=e.createElement("div");n.classList.add(w("v")),this.element.appendChild(n),this.valueElement=n}}function y(e,t){return s=>{!function(e,t,s){s?e.classList.add(t):e.classList.remove(t)}(e,t,s)}}class x extends r{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},s=r.createCore(t);return new x(s)}get styleExpanded(){var e;return null!==(e=this.get("temporaryExpanded"))&&void 0!==e?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!t(e)?`${e}px`:"auto"}bindExpandedClass(e,t){_(this,"expanded",(()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)}))}}function E(e,t){t.style.height=e.styleHeight}function C(e,s){e.value("expanded").emitter.on("beforechange",(()=>{e.set("completed",!1),t(e.get("expandedHeight"))&&e.set("expandedHeight",function(e,t){let s=0;return function(e,t){const s=e.style.transition;e.style.transition="none",t(),e.style.transition=s}(t,(()=>{e.set("expandedHeight",null),e.set("temporaryExpanded",!0),m(t),s=t.clientHeight,e.set("temporaryExpanded",null),m(t)})),s}(e,s)),e.set("shouldFixHeight",!0),m(s)})),e.emitter.on("change",(()=>{E(e,s)})),E(e,s),s.addEventListener("transitionend",(t=>{"height"===t.propertyName&&(e.set("shouldFixHeight",!1),e.set("expandedHeight",null),e.set("completed",!0))}))}class P extends class extends class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((e=>{t.classList.remove(p(void 0,d[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(p(void 0,d[e]))}))})),this.viewProps.handleDispose((()=>{!function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}(t)}))}get parent(){return this.parent_}}{constructor(e){super(e),this.value=e.value}}{constructor(e,t){const s=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new f(e,{props:t.props,viewProps:s}),viewProps:s})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class V{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let s=e;return t(this.minValue)||(s=Math.max(s,this.minValue)),t(this.maxValue)||(s=Math.min(s,this.maxValue)),s}}const L=u("pop");class k{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(L()),t.viewProps.bindClassModifiers(this.element),b(t.shows,y(this.element,L(void 0,"v")))}}class M{constructor(e,t){this.shows=o(!1),this.viewProps=t.viewProps,this.view=new k(e,{shows:this.shows,viewProps:this.viewProps})}}const D=u("txt");class z{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(D()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const s=e.createElement("input");s.classList.add(D("i")),s.type="text",t.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class K{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new z(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const s=e.currentTarget.value,i=this.parser_(s);t(i)||(this.value.rawValue=i),this.view.refresh()}}class T{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const S={"**":(e,t)=>Math.pow(e,t),"*":(e,t)=>e*t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t,"&":(e,t)=>e&t,"^":(e,t)=>e^t,"|":(e,t)=>e|t};class j{constructor(e,t,s){this.left=t,this.operator=e,this.right=s}evaluate(){const e=S[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const N={"+":e=>e,"-":e=>-e,"~":e=>~e};class B{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=N[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function O(e){return(t,s)=>{for(let i=0;i<e.length;i++){const n=e[i](t,s);if(""!==n)return n}return""}}function A(e,t){var s;const i=e.substr(t).match(/^\s+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}function $(e,t){var s;const i=e.substr(t).match(/^[0-9]+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}function H(e,t){const s=e.substr(t,1);if(t+=1,"e"!==s.toLowerCase())return"";const i=function(e,t){const s=$(e,t);if(""!==s)return s;const i=e.substr(t,1);if("-"!==i&&"+"!==i)return"";const n=$(e,t+=1);return""===n?"":i+n}(e,t);return""===i?"":s+i}function I(e,t){const s=e.substr(t,1);if("0"===s)return s;const i=function(e,t){const s=e.substr(t,1);return s.match(/^[1-9]$/)?s:""}(e,t);return t+=i.length,""===i?"":i+$(e,t)}const q=O([function(e,t){const s=I(e,t);if(t+=s.length,""===s)return"";const i=e.substr(t,1);if(t+=i.length,"."!==i)return"";const n=$(e,t);return s+i+n+H(e,t+=n.length)},function(e,t){const s=e.substr(t,1);if(t+=s.length,"."!==s)return"";const i=$(e,t);return t+=i.length,""===i?"":s+i+H(e,t)},function(e,t){const s=I(e,t);return t+=s.length,""===s?"":s+H(e,t)}]);const R=O([function(e,t){const s=e.substr(t,2);if(t+=s.length,"0b"!==s.toLowerCase())return"";const i=function(e,t){var s;const i=e.substr(t).match(/^[01]+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}(e,t);return""===i?"":s+i},function(e,t){const s=e.substr(t,2);if(t+=s.length,"0o"!==s.toLowerCase())return"";const i=function(e,t){var s;const i=e.substr(t).match(/^[0-7]+/);return null!==(s=i&&i[0])&&void 0!==s?s:""}(e,t);return""===i?"":s+i},function(e,t){const s=e.substr(t,2);if(t+=s.length,"0x"!==s.toLowerCase())return"";const i=function(e,t){var s;const i=e.substr(t).match(/^[0-9a-f]+/i);return null!==(s=i&&i[0])&&void 0!==s?s:""}(e,t);return""===i?"":s+i}]),F=O([R,q]);function U(e,t){return function(e,t){const s=F(e,t);return t+=s.length,""===s?null:{evaluable:new T(s),cursor:t}}(e,t)||function(e,t){const s=e.substr(t,1);if(t+=s.length,"("!==s)return null;const i=W(e,t);if(!i)return null;t=i.cursor,t+=A(e,t).length;const n=e.substr(t,1);return t+=n.length,")"!==n?null:{evaluable:i.evaluable,cursor:t}}(e,t)}function X(e,t,s){s+=A(t,s).length;const i=e.filter((e=>t.startsWith(e,s)))[0];return i?(s+=i.length,{cursor:s+=A(t,s).length,operator:i}):null}const Y=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce(((e,t)=>function(e,t){return(s,i)=>{const n=e(s,i);if(!n)return null;i=n.cursor;let o=n.evaluable;for(;;){const n=X(t,s,i);if(!n)break;i=n.cursor;const r=e(s,i);if(!r)return null;i=r.cursor,o=new j(n.operator,o,r.evaluable)}return o?{cursor:i,evaluable:o}:null}}(e,t)),(function e(t,s){const i=U(t,s);if(i)return i;const n=t.substr(s,1);if(s+=n.length,"+"!==n&&"-"!==n&&"~"!==n)return null;const o=e(t,s);return o?{cursor:s=o.cursor,evaluable:new B(n,o.evaluable)}:null}));function W(e,t){return t+=A(e,t).length,Y(e,t)}function G(e){var t;const s=function(e){const t=W(e,0);return t?t.cursor+A(e,t.cursor).length!==e.length?null:t.evaluable:null}(e);return null!==(t=null==s?void 0:s.evaluate())&&void 0!==t?t:null}function J(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}function Q({primary:e,secondary:t,forward:s,backward:i}){let n=!1;function o(e){n||(n=!0,e(),n=!1)}e.emitter.on("change",(()=>{o((()=>{t.rawValue=s(e,t)}))})),t.emitter.on("change",(()=>{o((()=>{e.rawValue=i(e,t)})),o((()=>{t.rawValue=s(e,t)}))})),o((()=>{t.rawValue=s(e,t)}))}function Z(e,t){const s=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+s:t.downKey?-s:0}function ee(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function te(e,t){const s=t.ownerDocument.defaultView,i=t.getBoundingClientRect();return{x:e.pageX-((s&&s.scrollX||0)+i.left),y:e.pageY-((s&&s.scrollY||0)+i.top)}}class se{constructor(e){this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new s,e.addEventListener("touchstart",this.onTouchStart_),e.addEventListener("touchmove",this.onTouchMove_),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();const s=this.elem_.ownerDocument;s.addEventListener("mousemove",this.onDocumentMouseMove_),s.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(te(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(te(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(te(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-s.left,y:t.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}onTouchMove_(e){const t=e.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-s.left,y:t.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}onTouchEnd_(e){const t=e.targetTouches.item(0),s=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-s.left,y:t.clientY-s.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function ie(e,t,s,i,n){return i+(e-t)/(s-t)*(n-i)}function ne(e,t,s){return Math.min(Math.max(e,t),s)}const oe=u("txt");class re{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(oe(),oe(void 0,"num")),t.arrayPosition&&this.element.classList.add(oe(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("input");s.classList.add(oe("i")),s.type="text",t.viewProps.bindDisabled(s),this.element.appendChild(s),this.inputElement=s,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(oe()),this.inputElement.classList.add(oe("i"));const i=e.createElement("div");i.classList.add(oe("k")),this.element.appendChild(i),this.knobElement=i;const n=e.createElementNS(v,"svg");n.classList.add(oe("g")),this.knobElement.appendChild(n);const o=e.createElementNS(v,"path");o.classList.add(oe("gb")),n.appendChild(o),this.guideBodyElem_=o;const r=e.createElementNS(v,"path");r.classList.add(oe("gh")),n.appendChild(r),this.guideHeadElem_=r;const a=e.createElement("div");a.classList.add(u("tt")()),this.knobElement.appendChild(a),this.tooltipElem_=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(null===e.rawValue)return void this.element.classList.remove(oe(void 0,"drg"));this.element.classList.add(oe(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),s=t+(t>0?-1:t<0?1:0),i=ne(-s,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${s+i},0 L${s},4 L${s+i},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const n=this.props_.get("formatter");this.tooltipElem_.textContent=n(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class ae{constructor(e,t){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=o(null),this.view=new re(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_);const s=new se(this.view.knobElement);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_),s.emitter.on("up",this.onPointerUp_)}onInputChange_(e){const s=e.currentTarget.value,i=this.parser_(s);t(i)||(this.value.rawValue=i),this.view.refresh()}onInputKeyDown_(e){const t=Z(this.baseStep_,ee(e));0!==t&&(this.value.rawValue+=t)}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}onPointerMove_(e){if(!e.data.point)return;const t=e.data.point.x-e.data.bounds.width/2;this.value.rawValue=this.originRawValue_+t*this.props.get("draggingScale"),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_}onPointerUp_(){this.dragging_.rawValue=null}}class le{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map(((e,t)=>{var s,i;return null!==(i=null===(s=this.components[t])||void 0===s?void 0:s.constrain(e))&&void 0!==i?i:e}));return this.asm_.fromComponents(t)}}const he=u("pndtxt");class ce{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(he()),this.textViews.forEach((t=>{const s=e.createElement("div");s.classList.add(he("a")),s.appendChild(t.element),this.element.appendChild(s)}))}}class ue{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map(((s,i)=>function(e,t,s){return new ae(e,{arrayPosition:0===s?"fst":s===t.axes.length-1?"lst":"mid",baseStep:t.axes[s].baseStep,parser:t.parser,props:t.axes[s].textProps,value:o(0,{constraint:t.axes[s].constraint}),viewProps:t.viewProps})}(e,t,i))),this.acs_.forEach(((e,s)=>{Q({primary:this.value,secondary:e.value,forward:e=>t.assembly.toComponents(e.rawValue)[s],backward:(e,i)=>{const n=t.assembly.toComponents(e.rawValue);return n[s]=i.rawValue,t.assembly.fromComponents(n)}})})),this.view=new ce(e,{textViews:this.acs_.map((e=>e.view))})}}class pe extends class{constructor(e){this.controller_=e}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get value(){return this.controller_.valueController.value.rawValue}}function de(e,t,s){return e*(1-s)+t*s}function ve(e,t){let s=.25,i=.5,n=-1;for(let o=0;o<20;o++){const[o,r]=e.curve(i);if(i+=s*(o<t?1:-1),n=r,s*=.5,Math.abs(t-o)<.001)break}return n}class me{constructor(e=0,t=0,s=1,i=1){this.cache_=[],this.comps_=[e,t,s,i]}get x1(){return this.comps_[0]}get y1(){return this.comps_[1]}get x2(){return this.comps_[2]}get y2(){return this.comps_[3]}static isObject(e){return!t(e)&&(!!Array.isArray(e)&&("number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]&&"number"==typeof e[3]))}static equals(e,t){return e.x1===t.x1&&e.y1===t.y1&&e.x2===t.x2&&e.y2===t.y2}curve(e){const t=de(0,this.x1,e),s=de(0,this.y1,e),i=de(this.x1,this.x2,e),n=de(this.y1,this.y2,e),o=de(this.x2,1,e),r=de(this.y2,1,e),a=de(t,i,e),l=de(s,n,e),h=de(i,o,e),c=de(n,r,e);return[de(a,h,e),de(l,c,e)]}y(e){if(0===this.cache_.length){const e=[];for(let t=0;t<100;t++)e.push(ve(this,ie(t,0,99,0,1)));this.cache_=e}return this.cache_[Math.round(ie(ne(e,0,1),0,1,0,99))]}toObject(){return[this.comps_[0],this.comps_[1],this.comps_[2],this.comps_[3]]}}const ge={toComponents:e=>e.toObject(),fromComponents:e=>new me(...e)};function be(e){const t=J(2);return`cubic-bezier(${e.toObject().map((e=>t(e))).join(", ")})`}const _e=[0,.5,.5,1];function we(e){const t=e.match(/^cubic-bezier\s*\(\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*,\s*([0-9.]+)\s*\)$/);if(!t)return new me(..._e);const s=[t[1],t[2],t[3],t[4]].reduce(((e,t)=>{if(!e)return null;const s=Number(t);return isNaN(s)?null:[...e,s]}),[]);return new me(...null!=s?s:_e)}const fe=u("cbz");class ye{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(fe()),t.viewProps.bindClassModifiers(this.element),t.foldable.bindExpandedClass(this.element,fe(void 0,"expanded")),_(t.foldable,"completed",y(this.element,fe(void 0,"cpl")));const s=e.createElement("div");s.classList.add(fe("h")),this.element.appendChild(s);const i=e.createElement("button");i.classList.add(fe("b")),t.viewProps.bindDisabled(i);const n=e.createElementNS(v,"svg");n.innerHTML='<path d="M2 13C8 13 8 3 14 3"/>',i.appendChild(n),s.appendChild(i),this.buttonElement=i;const o=e.createElement("div");if(o.classList.add(fe("t")),s.appendChild(o),this.textElement=o,"inline"===t.pickerLayout){const t=e.createElement("div");t.classList.add(fe("p")),this.element.appendChild(t),this.pickerElement=t}else this.pickerElement=null}}const xe=u("cbzp");class Ee{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(xe()),t.viewProps.bindClassModifiers(this.element);const s=e.createElement("div");s.classList.add(xe("g")),this.element.appendChild(s),this.graphElement=s;const i=e.createElement("div");i.classList.add(xe("t")),this.element.appendChild(i),this.textElement=i}}function Ce(e,t){const s=new MutationObserver((e=>{for(const i of e)"childList"===i.type&&i.addedNodes.forEach((e=>{e.contains(e)&&(t(),s.disconnect())}))})),i=e.ownerDocument;s.observe(i.body,{attributes:!0,childList:!0,subtree:!0})}const Pe=u("cbzg");class Ve{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Pe()),t.viewProps.bindClassModifiers(this.element),t.viewProps.bindTabIndex(this.element);const s=e.createElement("div");s.classList.add(Pe("p")),this.element.appendChild(s),this.previewElement=s;const i=e.createElementNS(v,"svg");i.classList.add(Pe("g")),this.element.appendChild(i),this.svgElem_=i;const n=e.createElementNS(v,"path");n.classList.add(Pe("u")),this.svgElem_.appendChild(n),this.guideElem_=n;const o=e.createElementNS(v,"polyline");o.classList.add(Pe("l")),this.svgElem_.appendChild(o),this.lineElem_=o,this.handleElems_=[e.createElement("div"),e.createElement("div")],this.handleElems_.forEach((e=>{e.classList.add(Pe("h")),this.element.appendChild(e)})),this.vectorElems_=[e.createElementNS(v,"line"),e.createElementNS(v,"line")],this.vectorElems_.forEach((e=>{e.classList.add(Pe("v")),this.svgElem_.appendChild(e)})),this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),this.sel_=t.selection,this.handleElems_.forEach(((e,t)=>{var s,i;b(this.sel_,(s=e=>e===t,i=y(e,Pe("h","sel")),e=>i(s(e))))})),Ce(this.element,(()=>{this.refresh()}))}getVertMargin_(e){return.25*e}valueToPosition(e,t){const s=this.element.getBoundingClientRect(),i=s.width,n=s.height,o=this.getVertMargin_(n);return{x:ie(e,0,1,0,i),y:ie(t,0,1,n-o,o)}}positionToValue(e,t){const s=this.element.getBoundingClientRect(),i=s.width,n=s.height,o=this.getVertMargin_(n);return{x:ne(ie(e,0,i,0,1),0,1),y:ie(t,n-o,o,0,1)}}refresh(){this.guideElem_.setAttributeNS(null,"d",[0,1].map((e=>{const t=this.valueToPosition(0,e),s=this.valueToPosition(1,e);return[`M ${t.x},${t.y}`,`L ${s.x},${s.y}`].join(" ")})).join(" "));const e=this.value_.rawValue,t=[];let s=0;for(;;){const i=this.valueToPosition(...e.curve(s));if(t.push([i.x,i.y].join(",")),s>=1)break;s=Math.min(s+.05,1)}this.lineElem_.setAttributeNS(null,"points",t.join(" "));const i=e.toObject();[0,1].forEach((e=>{const t=this.valueToPosition(e,e),s=this.valueToPosition(i[2*e],i[2*e+1]),n=this.vectorElems_[e];n.setAttributeNS(null,"x1",String(t.x)),n.setAttributeNS(null,"y1",String(t.y)),n.setAttributeNS(null,"x2",String(s.x)),n.setAttributeNS(null,"y2",String(s.y));const o=this.handleElems_[e];o.style.left=`${s.x}px`,o.style.top=`${s.y}px`}))}onValueChange_(){this.refresh()}}const Le=u("cbzprv");class ke{constructor(e,t){this.stopped_=!0,this.startTime_=-1,this.onDispose_=this.onDispose_.bind(this),this.onTimer_=this.onTimer_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Le()),t.viewProps.bindClassModifiers(this.element);const s=e.createElementNS(v,"svg");s.classList.add(Le("g")),this.element.appendChild(s),this.svgElem_=s;const i=e.createElementNS(v,"path");i.classList.add(Le("t")),this.svgElem_.appendChild(i),this.ticksElem_=i;const n=e.createElement("div");n.classList.add(Le("m")),this.element.appendChild(n),this.markerElem_=n,this.value_=t.value,this.value_.emitter.on("change",this.onValueChange_),t.viewProps.handleDispose(this.onDispose_),Ce(this.element,(()=>{this.refresh()}))}play(){this.stop(),this.updateMarker_(0),this.markerElem_.classList.add(Le("m","a")),this.startTime_=(new Date).getTime()+400,this.stopped_=!1,requestAnimationFrame(this.onTimer_)}stop(){this.stopped_=!0,this.markerElem_.classList.remove(Le("m","a"))}onDispose_(){this.stop()}updateMarker_(e){const t=this.value_.rawValue.y(ne(e,0,1));this.markerElem_.style.left=100*t+"%"}refresh(){const e=this.svgElem_.getBoundingClientRect(),t=e.width,s=e.height,i=[],n=this.value_.rawValue;for(let e=0;e<24;e++){const o=ie(e,0,23,0,1),r=ie(n.y(o),0,1,0,t);i.push(`M ${r},0 v${s}`)}this.ticksElem_.setAttributeNS(null,"d",i.join(" "))}onTimer_(){if(null===this.startTime_)return;const e=(new Date).getTime()-this.startTime_,t=e/1e3;this.updateMarker_(t),e>1400&&this.stop(),this.stopped_||requestAnimationFrame(this.onTimer_)}onValueChange_(){this.refresh(),this.play()}}function Me(e,t,s,i){const n=s-e,o=i-t;return Math.sqrt(n*n+o*o)}class De{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.sel_=o(0),this.viewProps=t.viewProps,this.view=new Ve(e,{selection:this.sel_,value:this.value,viewProps:this.viewProps}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.prevView_=new ke(e,{value:this.value,viewProps:this.viewProps}),this.prevView_.element.addEventListener("mousedown",(e=>{e.stopImmediatePropagation(),e.preventDefault(),this.prevView_.play()})),this.view.previewElement.appendChild(this.prevView_.element);const s=new se(this.view.element);s.emitter.on("down",this.onPointerDown_),s.emitter.on("move",this.onPointerMove_)}refresh(){this.view.refresh(),this.prevView_.refresh(),this.prevView_.play()}updateValue_(e,t){const s=this.sel_.rawValue,i=this.value.rawValue.toObject(),n=this.view.positionToValue(e.x,e.y),o=t?function(e,t,s,i){const n=Me(e,t,s,i),o=Math.atan2(i-t,s-e),r=Math.round(o/(Math.PI/4))*Math.PI/4;return{x:e+Math.cos(r)*n,y:t+Math.sin(r)*n}}(s,s,n.x,n.y):n;i[2*s]=o.x,i[2*s+1]=o.y,this.value.rawValue=new me(...i)}onPointerDown_(e){const t=e.data;if(!t.point)return;const s=this.value.rawValue,i=this.view.valueToPosition(s.x1,s.y1),n=Me(t.point.x,t.point.y,i.x,i.y),o=this.view.valueToPosition(s.x2,s.y2),r=Me(t.point.x,t.point.y,o.x,o.y);this.sel_.rawValue=n<=r?0:1,this.updateValue_(t.point,e.shiftKey)}onPointerMove_(e){const t=e.data;t.point&&this.updateValue_(t.point,e.shiftKey)}onKeyDown_(e){var t;(function(e){return"ArrowUp"===e||"ArrowDown"===e}(t=e.key)||"ArrowLeft"===t||"ArrowRight"===t)&&e.preventDefault();const s=this.sel_.rawValue,i=this.value.rawValue.toObject();i[2*s]+=Z(this.baseStep_,function(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}(e)),i[2*s+1]+=Z(this.baseStep_,ee(e)),this.value.rawValue=new me(...i)}}class ze{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Ee(e,{viewProps:this.viewProps}),this.gc_=new De(e,{baseStep:t.axis.baseStep,value:this.value,viewProps:this.viewProps}),this.view.graphElement.appendChild(this.gc_.view.element);const s=Object.assign(Object.assign({},t.axis),{constraint:new V({max:1,min:0})}),i=Object.assign(Object.assign({},t.axis),{constraint:void 0});this.tc_=new ue(e,{assembly:ge,axes:[s,i,s,i],parser:G,value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element)}get allFocusableElements(){return[this.gc_.view.element,...this.tc_.view.textViews.map((e=>e.inputElement))]}refresh(){this.gc_.refresh()}}class Ke{constructor(e,t){var s;this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=(s=t.expanded,x.create(s)),this.view=new ye(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.tc_=new K(e,{parser:we,props:r.fromObject({formatter:be}),value:this.value,viewProps:this.viewProps}),this.view.textElement.appendChild(this.tc_.view.element),this.popC_="popup"===t.pickerLayout?new M(e,{viewProps:this.viewProps}):null;const i=new ze(e,{axis:t.axis,value:this.value,viewProps:this.viewProps});i.allFocusableElements.forEach((e=>{e.addEventListener("blur",this.onPopupChildBlur_),e.addEventListener("keydown",this.onPopupChildKeydown_)})),this.pickerC_=i,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),b(this.popC_.shows,(e=>{e&&i.refresh()})),Q({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:e=>e.rawValue,backward:(e,t)=>t.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),C(this.foldable_,this.view.pickerElement))}onButtonBlur_(e){if(!this.popC_)return;const t=e.relatedTarget;t&&this.popC_.view.element.contains(t)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,s=function(e){return e.relatedTarget?e.relatedTarget:"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}(e);s&&t.contains(s)||(s&&s===this.view.buttonElement&&void 0===t.ownerDocument.ontouchstart||(this.popC_.shows.rawValue=!1))}onPopupChildKeydown_(e){this.popC_&&"Escape"===e.key&&(this.popC_.shows.rawValue=!1)}}const Te={id:"cubic-bezier",type:"blade",css:".tp-cbzv_b,.tp-cbzgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-cbzv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-cbzv_b:hover{background-color:var(--btn-bg-h)}.tp-cbzv_b:focus{background-color:var(--btn-bg-f)}.tp-cbzv_b:active{background-color:var(--btn-bg-a)}.tp-cbzv_b:disabled{opacity:0.5}.tp-cbzgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-cbzgv:hover{background-color:var(--in-bg-h)}.tp-cbzgv:focus{background-color:var(--in-bg-f)}.tp-cbzgv:active{background-color:var(--in-bg-a)}.tp-cbzgv:disabled{opacity:0.5}.tp-cbzv{position:relative}.tp-cbzv_h{display:flex}.tp-cbzv_b{margin-right:4px;position:relative;width:var(--bld-us)}.tp-cbzv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-cbzv_b svg path{stroke:var(--bs-bg);stroke-width:2}.tp-cbzv_t{flex:1}.tp-cbzv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-cbzv.tp-cbzv-expanded .tp-cbzv_p{margin-top:var(--bld-s);opacity:1}.tp-cbzv.tp-cbzv-cpl .tp-cbzv_p{overflow:visible}.tp-cbzv .tp-popv{left:calc(-1 * var(--cnt-h-p));position:absolute;right:calc(-1 * var(--cnt-h-p));top:var(--bld-us)}.tp-cbzpv_t{margin-top:var(--bld-s)}.tp-cbzgv{height:auto;overflow:hidden;position:relative}.tp-cbzgv.tp-v-disabled{opacity:0.5}.tp-cbzgv_p{left:16px;position:absolute;right:16px;top:0}.tp-cbzgv_g{cursor:pointer;display:block;height:calc(var(--bld-us) * 5);width:100%}.tp-cbzgv_u{opacity:0.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_l{fill:transparent;stroke:var(--in-fg)}.tp-cbzgv_v{opacity:0.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-cbzgv_h{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;pointer-events:none;position:absolute;width:4px}.tp-cbzgv:focus .tp-cbzgv_h-sel{background-color:var(--in-fg);border-width:0}.tp-cbzprvv{cursor:pointer;height:4px;padding:4px 0;position:relative}.tp-cbzprvv_g{display:block;height:100%;overflow:visible;width:100%}.tp-cbzprvv_t{opacity:0.5;stroke:var(--mo-fg)}.tp-cbzprvv_m{background-color:var(--mo-fg);border-radius:50%;height:4px;margin-left:-2px;margin-top:-2px;opacity:0;position:absolute;top:50%;transition:opacity 0.2s ease-out;width:4px}.tp-cbzprvv_m.tp-cbzprvv_m-a{opacity:1}",accept(e){const t=h,s=function(e,t){const s=h.required.object(t)(e);return s.succeeded?s.value:void 0}(e,{value:t.required.array(t.required.number),view:t.required.constant("cubicbezier"),expanded:t.optional.boolean,label:t.optional.string,picker:t.optional.custom((e=>"inline"===e||"popup"===e?e:void 0))});return s?{params:s}:null},controller(e){var t,s;const i=o(new me(...e.params.value),{constraint:new le({assembly:ge,components:[0,1,2,3].map((e=>e%2==0?new V({min:0,max:1}):void 0))}),equals:me.equals}),n=new Ke(e.document,{axis:{baseStep:.1,textProps:r.fromObject({draggingScale:.01,formatter:J(2)})},expanded:null!==(t=e.params.expanded)&&void 0!==t&&t,pickerLayout:null!==(s=e.params.picker)&&void 0!==s?s:"popup",value:i,viewProps:e.viewProps});return new P(e.document,{blade:e.blade,props:r.fromObject({label:e.params.label}),valueController:n})},api:e=>e.controller instanceof P&&e.controller.valueController instanceof Ke?new pe(e.controller):null};e.plugin=Te,Object.defineProperty(e,"__esModule",{value:!0})}));
