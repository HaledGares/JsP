!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TweakpaneGrouplistPlugin={})}(this,(function(e){"use strict";class t extends class{constructor(e){this.target=e}}{constructor(e,t,r,n){super(e),this.value=t,this.presetKey=r,this.last=null==n||n}}function r(e){return null==e}class n{constructor(){this.observers_={}}on(e,t){let r=this.observers_[e];return r||(r=this.observers_[e]=[]),r.push({handler:t}),this}off(e,t){const r=this.observers_[e];return r&&(this.observers_[e]=r.filter((e=>e.handler!==t))),this}emit(e,t){const r=this.observers_[e];r&&r.forEach((e=>{e.handler(t)}))}}const s="tp";function o(e){return(t,r)=>[s,"-",e,"v",t?`_${t}`:"",r?`-${r}`:""].join("")}function i(e){return e.rawValue}function a(e,t,r){!function(e,t){var r,n;e.emitter.on("change",(r=i,n=t,e=>n(r(e)))),t(e.rawValue)}(e.value(t),r)}class l{constructor(e,t){var r;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(r=null==t?void 0:t.equals)&&void 0!==r?r:(e,t)=>e===t,this.emitter=new n,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const r=null!=t?t:{forceEmit:!1,last:!0},n=this.constraint_?this.constraint_.constrain(e):e;(!this.equals_(this.rawValue_,n)||r.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=n,this.emitter.emit("change",{options:r,rawValue:n,sender:this}))}}class u{constructor(e){this.emitter=new n,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const r=null!=t?t:{forceEmit:!1,last:!0};(this.value_!==e||r.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:r,rawValue:this.value_,sender:this}))}}function c(e,t){const r=null==t?void 0:t.constraint,n=null==t?void 0:t.equals;return r||n?new l(e,t):new u(e)}class p{constructor(e){this.emitter=new n,this.valMap_=e;for(const e in this.valMap_){this.valMap_[e].emitter.on("change",(()=>{this.emitter.emit("change",{key:e,sender:this})}))}}static createCore(e){return Object.keys(e).reduce(((t,r)=>Object.assign(t,{[r]:c(e[r])})),{})}static fromObject(e){const t=this.createCore(e);return new p(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function d(e){return t=>r=>{if(!t&&void 0===r)return{succeeded:!1,value:void 0};if(t&&void 0===r)return{succeeded:!0,value:void 0};const n=e(r);return void 0!==n?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function h(e){return{custom:t=>d(t)(e),boolean:d((e=>"boolean"==typeof e?e:void 0))(e),number:d((e=>"number"==typeof e?e:void 0))(e),string:d((e=>"string"==typeof e?e:void 0))(e),function:d((e=>"function"==typeof e?e:void 0))(e),constant:t=>d((e=>e===t?t:void 0))(e),raw:d((e=>e))(e),object:t=>d((e=>{var r;if(null!==(r=e)&&"object"==typeof r)return function(e,t){return Object.keys(t).reduce(((r,n)=>{if(void 0===r)return;const s=(0,t[n])(e[n]);return s.succeeded?Object.assign(Object.assign({},r),{[n]:s.value}):void 0}),{})}(e,t)}))(e),array:t=>d((e=>{var r;if(Array.isArray(e))return r=t,e.reduce(((e,t)=>{if(void 0===e)return;const n=r(t);return n.succeeded&&void 0!==n.value?[...e,n.value]:void 0}),[])}))(e)}}const v={optional:h(!0),required:h(!1)};function f(e,t){const r=v.required.object(t)(e);return r.succeeded?r.value:void 0}const m=o(""),g={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};const w={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};const b=o("lbl");class _{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(b()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(b("l")),a(t.props,"label",(t=>{r(t)?this.element.classList.add(b(void 0,"nol")):(this.element.classList.remove(b(void 0,"nol")),function(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}(n),n.appendChild(function(e,t){const r=e.createDocumentFragment();return t.split("\n").map((t=>e.createTextNode(t))).forEach(((t,n)=>{n>0&&r.appendChild(e.createElement("br")),r.appendChild(t)})),r}(e,t)))})),this.element.appendChild(n),this.labelElement=n;const s=e.createElement("div");s.classList.add(b("v")),this.element.appendChild(s),this.valueElement=s}}class C extends class extends class{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",(()=>{["veryfirst","first","last","verylast"].forEach((e=>{t.classList.remove(m(void 0,g[e]))})),this.blade.get("positions").forEach((e=>{t.classList.add(m(void 0,g[e]))}))})),this.viewProps.handleDispose((()=>{!function(e){e&&e.parentElement&&e.parentElement.removeChild(e)}(t)}))}get parent(){return this.parent_}}{constructor(e){super(e),this.value=e.value}}{constructor(e,t){const r=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new _(e,{props:t.props,viewProps:r}),viewProps:r})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class y{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce(((e,t)=>t.constrain(e)),e)}}function E(e){return t=>t.toFixed(Math.max(Math.min(e,20),0))}E(0);function j(e){return String(e)}function V(e,t){e.write(t)}function P(e){return[e[0],e[1],e[2]]}function x(e){return t=>function(e,t){const r=E("float"===t?2:0);return`rgb(${P(e.getComponents("rgb",t)).map((e=>r(e))).join(", ")})`}(t,e)}function q(e){return t=>function(e,t){const r=E(2),n=E("float"===t?2:0);return`rgba(${e.getComponents("rgb",t).map(((e,t)=>(3===t?r:n)(e))).join(", ")})`}(t,e)}function M(e){return t=>function(e,t){const r=E("float"===t?2:0),n=["r","g","b"];return`{${P(e.getComponents("rgb",t)).map(((e,t)=>`${n[t]}: ${r(e)}`)).join(", ")}}`}(t,e)}function O(e){return t=>function(e,t){const r=E(2),n=E("float"===t?2:0),s=["r","g","b","a"];return`{${e.getComponents("rgb",t).map(((e,t)=>`${s[t]}: ${(3===t?r:n)(e)}`)).join(", ")}}`}(t,e)}["int","float"].reduce(((e,t)=>[...e,{format:{alpha:!1,mode:"rgb",notation:"func",type:t},stringifier:x(t)},{format:{alpha:!0,mode:"rgb",notation:"func",type:t},stringifier:q(t)},{format:{alpha:!1,mode:"rgb",notation:"object",type:t},stringifier:M(t)},{format:{alpha:!0,mode:"rgb",notation:"object",type:t},stringifier:O(t)}]),[]);const L=o("lst");class S{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(L()),t.viewProps.bindClassModifiers(this.element);const r=e.createElement("select");r.classList.add(L("s")),a(this.props_,"optgroups",(t=>{t.forEach(((t,n)=>{const s=e.createElement("optgroup");s.dataset.index=String(n),s.label=t.text,t.value.forEach(((t,r)=>{const n=e.createElement("option");n.dataset.index=String(r),n.textContent=t.text,n.value=String(t.value),s.appendChild(n)})),r.appendChild(s)}))})),t.viewProps.bindDisabled(r),this.element.appendChild(r),this.selectElement=r;const n=e.createElement("div");n.classList.add(L("m")),n.appendChild(function(e,t){const r=e.createElementNS("http://www.w3.org/2000/svg","svg");return r.innerHTML=w[t],r}(e,"dropdown")),this.element.appendChild(n),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class ${constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new S(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const t=e.currentTarget;if(!t.selectedOptions.item(0))return;const r=Number(t.selectedIndex);this.value.rawValue=this.props.get("optgroups").flatMap((e=>e.value))[r].value}}class A{constructor(e){this.optgroups=e}constrain(e){const t=this.optgroups.flatMap((e=>e.value));if(0===t.length)return e;return t.filter((t=>t.value===e)).length>0?e:t[0].value}}function k(e){const t=v;return Array.isArray(e)?t.required.array(t.required.object({text:t.required.string,value:t.required.array(t.required.object({text:t.required.string,value:t.required.raw}))}))(e).value:"object"==typeof e?t.required.raw(e).value:void 0}function T(e){if(Array.isArray(e)&&e.every((e=>Array.isArray(e.value))))return e;const t=e;return Object.keys(t).map((e=>{const r=[];return Object.keys(t[e]).forEach((n=>r.push({text:n,value:t[e][n]}))),{text:e,value:r}}))}function N(e){const t=e?function(e,t){if(e instanceof t)return e;if(e instanceof y){const r=e.constraints.reduce(((e,r)=>e||(r instanceof t?r:null)),null);if(r)return r}return null}(e,A):null;return t?t.optgroups:null}class R extends class{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}{constructor(e){super(e),this.emitter_=new n,this.controller_.valueController.value.emitter.on("change",(e=>{this.emitter_.emit("change",{event:new t(this,e.rawValue)})}))}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get optgroups(){return this.controller_.valueController.props.get("optgroups")}set optgroups(e){this.controller_.valueController.props.set("optgroups",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const r=t.bind(this);return this.emitter_.on(e,(e=>{r(e.event)})),this}}function D(e){const t=[],n=r(s=e.optgroups)?null:new A(T(s));var s;return n&&t.push(n),new y(t)}const F=[{id:"grouplist",type:"blade",accept(e){const t=v,r=f(e,{optgroups:t.required.custom(k),value:t.required.raw,view:t.required.constant("grouplist"),label:t.optional.string});return r?{params:r}:null},controller(e){const t=new $(e.document,{props:p.fromObject({optgroups:T(e.params.optgroups)}),value:c(e.params.value),viewProps:e.viewProps});return new C(e.document,{blade:e.blade,props:p.fromObject({label:e.params.label}),valueController:t})},api:e=>e.controller instanceof C&&e.controller.valueController instanceof $?new R(e.controller):null},{id:"input-grouplist",type:"input",accept:(e,t)=>{if("string"!=typeof e)return null;const r=v,n=f(t,{optgroups:r.required.custom(k),view:r.required.constant("grouplist")});return n?{initialValue:e,params:n}:null},binding:{reader:e=>j,constraint:e=>D(e.params),writer:e=>V},controller:e=>{var t;const r=e.document,n=e.value,s=e.constraint;return new $(r,{props:p.fromObject({optgroups:null!==(t=N(s))&&void 0!==t?t:[]}),value:n,viewProps:e.viewProps})}}];e.plugins=F,Object.defineProperty(e,"__esModule",{value:!0})}));
